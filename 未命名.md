---
date : 2025-07-07 22:15
aliases:
  - åˆ¥åæ¸¬è©¦1
  - åˆ¥åæ¸¬è©¦2
tags:
  - æ¨™ç±¤æ¸¬è©¦1
  - æ¨™ç±¤æ¸¬è©¦2

---
# Metadata
Status :: ğŸŒ±
Note Type :: ğŸ“°
Source URL :: {æ–‡ç«  URL}
Author :: {ä½œè€…åç¨±}
Topics :: {ç­†è¨˜è·Ÿä»€éº¼ä¸»é¡Œæœ‰é—œï¼Œç”¨ `[Topic],[Topic]` æ ¼å¼}

---
# é€£çµç­†è¨˜
##### ğŸ“‘ [[æ­¡è¿]]
##### ğŸ“‘ [[æ­¡è¿]]

---

## å¾ä½ ç†Ÿæ‚‰çš„ C# é–‹å§‹ç†è§£

åœ¨ C# ä¸­ï¼Œä½ å¯èƒ½å·²ç¶“å¯«éé€™æ¨£çš„ç¨‹å¼ç¢¼ï¼š

```csharp
public async Task<string> GetUserDataAsync(int userId)
{
    var response = await httpClient.GetAsync($"/api/users/{userId}");
    var content = await response.Content.ReadAsStringAsync();
    return content;
}
```

JavaScript çš„ async/await æ¦‚å¿µå¹¾ä¹ä¸€æ¨¡ä¸€æ¨£ï¼Œåªæ˜¯èªæ³•ç¨æœ‰ä¸åŒã€‚é€™ç¨®ç›¸ä¼¼æ€§æœƒè®“ä½ çš„å­¸ç¿’éç¨‹æ›´åŠ é †æš¢ã€‚

## ç†è§£ async/await çš„æ ¸å¿ƒæ¦‚å¿µ

async/await å¯¦éš›ä¸Šæ˜¯ Promise çš„ä¸€ç¨®æ›´å„ªé›…çš„å¯«æ³•ã€‚ç•¶ä½ åœ¨å‡½å¼å‰é¢åŠ ä¸Š `async` é—œéµå­—ï¼Œé€™å€‹å‡½å¼å°±æœƒ==è‡ªå‹•å›å‚³ä¸€å€‹ Promise==ã€‚è€Œ `await` é—œéµå­—å‰‡è®“ä½ å¯ä»¥ã€Œç­‰å¾…ã€ä¸€å€‹ Promise å®Œæˆï¼Œå°±åƒæš«åœç¨‹å¼åŸ·è¡Œç›´åˆ°çµæœå‡ºç¾ã€‚

è®“æˆ‘å€‘å…ˆçœ‹ä¸€å€‹ç°¡å–®çš„å°æ¯”ï¼Œå¹«åŠ©ä½ ç†è§£å…©è€…ä¹‹é–“çš„é—œä¿‚ï¼š

```javascript
// ä½¿ç”¨å‚³çµ± Promise çš„å¯«æ³•
function fetchUserDataWithPromise(userId) {
    return fetch(`/api/users/${userId}`)
		// å–å¾—å›æ‡‰å…§å®¹ï¼šå¾ Response ç‰©ä»¶ä¸­è®€å– HTTP å›æ‡‰çš„ body å…§å®¹
	    // è§£æ JSONï¼šå°‡å›æ‡‰å…§å®¹ï¼ˆé€šå¸¸æ˜¯ JSON å­—ä¸²ï¼‰è§£ææˆ JavaScript ç‰©ä»¶
	    // å›å‚³ Promiseï¼šé€™æ˜¯ä¸€å€‹éåŒæ­¥æ“ä½œï¼Œæ‰€ä»¥å›å‚³ Promise
        .then(response => response.json())
        .then(userData => {
            console.log("å–å¾—ä½¿ç”¨è€…è³‡æ–™ï¼š", userData);
            return userData; // return Promise.resolve(userData);
        })
        .catch(error => {
            console.error("ç™¼ç”ŸéŒ¯èª¤ï¼š", error);
            throw error; // return Promise.reject(error);
        });
}

// ä½¿ç”¨ async/await çš„å¯«æ³• - æ˜¯ä¸æ˜¯çœ‹èµ·ä¾†æ›´æ¸…æ¥šï¼Ÿ
async function fetchUserDataWithAsync(userId) {
    try {
        const response = await fetch(`/api/users/${userId}`);
        const userData = await response.json();
        console.log("å–å¾—ä½¿ç”¨è€…è³‡æ–™ï¼š", userData);
        return userData; // return Promise.resolve(userData);
    } catch (error) {
        console.error("ç™¼ç”ŸéŒ¯èª¤ï¼š", error);
        throw error; // return Promise.reject(error)
    }
}
```

ä½ æ³¨æ„åˆ°äº†å—ï¼Ÿasync/await ç‰ˆæœ¬è®€èµ·ä¾†å°±åƒæ˜¯ä¸€èˆ¬çš„åŒæ­¥ç¨‹å¼ç¢¼ï¼Œä½†å¯¦éš›ä¸Šå®ƒä»ç„¶æ˜¯ç•°æ­¥åŸ·è¡Œçš„ã€‚é€™ç¨®å¯è®€æ€§çš„æå‡æ˜¯ async/await æœ€å¤§çš„å„ªå‹¢ã€‚

## async å‡½å¼çš„ç‰¹æ€§

ç•¶ä½ åœ¨å‡½å¼å‰é¢åŠ ä¸Š `async` é—œéµå­—æ™‚ï¼Œé€™å€‹å‡½å¼æœƒæœ‰å¹¾å€‹é‡è¦çš„ç‰¹æ€§ï¼š

é¦–å…ˆï¼Œå®ƒç¸½æ˜¯å›å‚³ä¸€å€‹ Promiseã€‚å³ä½¿ä½ åœ¨å‡½å¼ä¸­ç›´æ¥å›å‚³ä¸€å€‹å€¼ï¼ŒJavaScript ä¹Ÿæœƒè‡ªå‹•å°‡å®ƒåŒ…è£æˆä¸€å€‹ resolved çš„ Promiseã€‚

```javascript
// é€™å€‹å‡½å¼æœƒå›å‚³ Promise<string>
async function greetUser() {
    return "ä½ å¥½ï¼"; // è‡ªå‹•åŒ…è£æˆ Promise.resolve("ä½ å¥½ï¼")
}

// æ‰€ä»¥ä½ å¯ä»¥é€™æ¨£ä½¿ç”¨å®ƒ
greetUser().then(message => console.log(message)); // è¼¸å‡ºï¼šä½ å¥½ï¼
```

å…¶æ¬¡ï¼Œåªæœ‰åœ¨ async å‡½å¼å…§éƒ¨æ‰èƒ½ä½¿ç”¨ `await` é—œéµå­—ã€‚é€™æ˜¯ä¸€å€‹é‡è¦çš„è¦å‰‡ï¼Œè¨˜ä½å®ƒæœƒå¹«åŠ©ä½ é¿å…å¾ˆå¤šéŒ¯èª¤ã€‚

## await çš„é‹ä½œåŸç†

`await` é—œéµå­—çš„ä½œç”¨æ˜¯æš«åœå‡½å¼çš„åŸ·è¡Œï¼Œç›´åˆ° Promise è§£æå®Œæˆã€‚é‡è¦çš„æ˜¯è¦ç†è§£ï¼Œé€™ç¨®ã€Œæš«åœã€ä¸æœƒé˜»å¡æ•´å€‹ç¨‹å¼ï¼Œåªæ˜¯æš«åœç•¶å‰çš„å‡½å¼åŸ·è¡Œæµç¨‹ã€‚

```javascript
async function demonstrateAwait() {
    console.log("é–‹å§‹åŸ·è¡Œ");
    
    // é€™è£¡æœƒæš«åœï¼Œç­‰å¾… Promise å®Œæˆ
    const result = await new Promise(resolve => {
        setTimeout(() => resolve("å»¶é²çš„çµæœ"), 2000);
    });
    
    console.log("å–å¾—çµæœï¼š", result);
    console.log("å‡½å¼åŸ·è¡Œå®Œæˆ");
}

// å‘¼å«å‡½å¼
demonstrateAwait();
console.log("é€™è¡Œæœƒç«‹å³åŸ·è¡Œï¼Œä¸æœƒç­‰å¾…ä¸Šé¢çš„å‡½å¼å®Œæˆ");
```

é€™å€‹ç¯„ä¾‹æœƒè¼¸å‡ºï¼š

```
é–‹å§‹åŸ·è¡Œ
é€™è¡Œæœƒç«‹å³åŸ·è¡Œï¼Œä¸æœƒç­‰å¾…ä¸Šé¢çš„å‡½å¼å®Œæˆ
ï¼ˆç­‰å¾… 2 ç§’ï¼‰
å–å¾—çµæœï¼šå»¶é²çš„çµæœ
å‡½å¼åŸ·è¡Œå®Œæˆ
```

## åœ¨ä½ çš„å·¥ä½œç’°å¢ƒä¸­æ‡‰ç”¨ async/await

è®“æˆ‘å€‘çœ‹çœ‹å¦‚ä½•åœ¨ä½ çš„ Portal ç³»çµ±ï¼ˆä½¿ç”¨ jQuery 3.3.1ï¼‰ä¸­æ‡‰ç”¨é€™äº›æ¦‚å¿µã€‚jQuery æœ¬èº«ä¸¦ä¸ç›´æ¥æ”¯æ´ Promiseï¼Œä½†æˆ‘å€‘å¯ä»¥è¼•é¬†åœ°å°‡ jQuery AJAX è½‰æ›ç‚º Promiseï¼š

```javascript
// å»ºç«‹ä¸€å€‹è¼”åŠ©å‡½å¼ï¼Œå°‡ jQuery AJAX è½‰æ›ç‚º Promise
function ajaxPromise(options) {
    return new Promise((resolve, reject) => {
        $.ajax(options)
            .done(resolve)  // æˆåŠŸæ™‚è§£æ Promise
            .fail(reject);  // å¤±æ•—æ™‚æ‹’çµ• Promise
    });
}

// ç¾åœ¨ä½ å¯ä»¥åœ¨ Portal ç³»çµ±ä¸­ä½¿ç”¨ async/await
async function loadUserProfile(userId) {
    try {
        // è¼‰å…¥åŸºæœ¬ä½¿ç”¨è€…è³‡æ–™
        const userData = await ajaxPromise({
            url: `/api/users/${userId}`,
            method: 'GET',
            dataType: 'json'
        });
        
        // æ ¹æ“šä½¿ç”¨è€…è³‡æ–™è¼‰å…¥éƒ¨é–€è³‡è¨Š
        const departmentData = await ajaxPromise({
            url: `/api/departments/${userData.departmentId}`,
            method: 'GET',
            dataType: 'json'
        });
        
        // æ›´æ–°é é¢é¡¯ç¤º
        $('#userName').text(userData.name);
        $('#userEmail').text(userData.email);
        $('#userDepartment').text(departmentData.name);
        
        console.log("ä½¿ç”¨è€…è³‡æ–™è¼‰å…¥å®Œæˆ");
        return { user: userData, department: departmentData };
        
    } catch (error) {
        console.error("è¼‰å…¥ä½¿ç”¨è€…è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š", error);
        $('#errorMessage').text('è¼‰å…¥ä½¿ç”¨è€…è³‡æ–™å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦').show();
        throw error; // é‡æ–°æ‹‹å‡ºéŒ¯èª¤è®“å‘¼å«è€…è™•ç†
    }
}
```

ä½ æ˜¯å¦æ³¨æ„åˆ°é€™å€‹ç¨‹å¼ç¢¼çš„æµç¨‹å¤šéº¼æ¸…æ™°ï¼Ÿæˆ‘å€‘å…ˆè¼‰å…¥ä½¿ç”¨è€…è³‡æ–™ï¼Œç„¶å¾Œæ ¹æ“šä½¿ç”¨è€…çš„éƒ¨é–€IDè¼‰å…¥éƒ¨é–€è³‡è¨Šï¼Œæœ€å¾Œæ›´æ–°é é¢ã€‚æ¯ä¸€æ­¥éƒ½æœƒç­‰å¾…å‰ä¸€æ­¥å®Œæˆï¼Œä½†æ•´å€‹éç¨‹ä»ç„¶æ˜¯ç•°æ­¥çš„ã€‚

## éŒ¯èª¤è™•ç†ï¼štry/catch çš„å¨åŠ›

async/await çš„å¦ä¸€å€‹å·¨å¤§å„ªå‹¢æ˜¯éŒ¯èª¤è™•ç†è®Šå¾—æ›´åŠ ç›´è§€ã€‚èˆ‡å…¶ä½¿ç”¨ `.catch()`ï¼Œä½ å¯ä»¥ä½¿ç”¨ç†Ÿæ‚‰çš„ `try/catch` å€å¡Šï¼š

```javascript
async function robustApiCall(endpoint, data) {
    try {
        // ç¬¬ä¸€æ­¥ï¼šé©—è­‰åƒæ•¸
        if (!endpoint) {
            throw new Error("API ç«¯é»ä¸èƒ½ç‚ºç©º");
        }
        
        // ç¬¬äºŒæ­¥ï¼šç™¼é€è«‹æ±‚
        const response = await fetch(endpoint, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${getAuthToken()}`
            },
            body: JSON.stringify(data)
        });
        
        // ç¬¬ä¸‰æ­¥ï¼šæª¢æŸ¥ HTTP ç‹€æ…‹
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        // ç¬¬å››æ­¥ï¼šè§£æå›æ‡‰
        const result = await response.json();
        
        // ç¬¬äº”æ­¥ï¼šé©—è­‰å›æ‡‰æ ¼å¼
        if (!result.success) {
            throw new Error(result.message || "API å›æ‡‰æŒ‡ç¤ºæ“ä½œå¤±æ•—");
        }
        
        return result.data;
        
    } catch (error) {
        // æ‰€æœ‰æ­¥é©Ÿä¸­çš„ä»»ä½•éŒ¯èª¤éƒ½æœƒåœ¨é€™è£¡è¢«æ•ç²
        console.error("API å‘¼å«å¤±æ•—ï¼š", error.message);
        
        // ä½ å¯ä»¥æ ¹æ“šä¸åŒçš„éŒ¯èª¤é¡å‹åšä¸åŒçš„è™•ç†
        if (error.message.includes("HTTP 401")) {
            // èªè­‰å¤±æ•—ï¼Œå¯èƒ½éœ€è¦é‡æ–°ç™»å…¥
            redirectToLogin();
        } else if (error.message.includes("HTTP 500")) {
            // ä¼ºæœå™¨éŒ¯èª¤
            showServerErrorMessage();
        }
        
        throw error; // é‡æ–°æ‹‹å‡ºè®“ä¸Šå±¤è™•ç†
    }
}
```

## ä¸¦è¡Œè™•ç†ï¼šç•¶ä½ ä¸éœ€è¦ç­‰å¾…æ™‚

æœ‰æ™‚å€™ä½ æœ‰å¤šå€‹ç¨ç«‹çš„ç•°æ­¥æ“ä½œï¼Œä¸éœ€è¦æŒ‰é †åºåŸ·è¡Œã€‚é€™æ™‚å€™ä½ å¯ä»¥çµåˆ `Promise.all` å’Œ async/awaitï¼š

```javascript
async function loadDashboardData(userId) {
    try {
        // é€™äº›è³‡æ–™å¯ä»¥åŒæ™‚è¼‰å…¥ï¼Œå› ç‚ºå®ƒå€‘äº’ä¸ä¾è³´
        const [userData, notifications, statistics, recentActivities] = await Promise.all([
            ajaxPromise({ url: `/api/users/${userId}`, method: 'GET' }),
            ajaxPromise({ url: `/api/notifications/${userId}`, method: 'GET' }),
            ajaxPromise({ url: `/api/statistics/${userId}`, method: 'GET' }),
            ajaxPromise({ url: `/api/activities/${userId}`, method: 'GET' })
        ]);
        
        // ç•¶æ‰€æœ‰è³‡æ–™éƒ½è¼‰å…¥å®Œæˆå¾Œï¼Œæ›´æ–°ä¸åŒçš„é é¢å€åŸŸ
        updateUserSection(userData);
        updateNotificationSection(notifications);
        updateStatisticsSection(statistics);
        updateActivitiesSection(recentActivities);
        
        console.log("å„€è¡¨æ¿æ‰€æœ‰è³‡æ–™è¼‰å…¥å®Œæˆ");
        
    } catch (error) {
        console.error("è¼‰å…¥å„€è¡¨æ¿è³‡æ–™å¤±æ•—ï¼š", error);
        showDashboardErrorMessage();
    }
}
```

é€™ç¨®æ–¹å¼æ¯”ä¾åºç­‰å¾…æ¯å€‹è«‹æ±‚å®Œæˆè¦å¿«å¾—å¤šï¼Œå› ç‚ºæ‰€æœ‰è«‹æ±‚æ˜¯åŒæ™‚ç™¼å‡ºçš„ã€‚

## å¯¦ç”¨çš„æ¨¡å¼ï¼šæ¢ä»¶æ€§ç•°æ­¥æ“ä½œ

åœ¨å¯¦éš›é–‹ç™¼ä¸­ï¼Œä½ ç¶“å¸¸éœ€è¦æ ¹æ“šæŸäº›æ¢ä»¶ä¾†æ±ºå®šæ˜¯å¦åŸ·è¡Œç•°æ­¥æ“ä½œï¼š

```javascript
async function smartUserDataLoader(userId, options = {}) {
    try {
        // å…ˆæª¢æŸ¥å¿«å–
        let userData = getCachedUserData(userId);
        
        if (!userData || options.forceRefresh) {
            console.log("å¾ä¼ºæœå™¨è¼‰å…¥ä½¿ç”¨è€…è³‡æ–™...");
            userData = await ajaxPromise({
                url: `/api/users/${userId}`,
                method: 'GET',
                dataType: 'json'
            });
            
            // å°‡è³‡æ–™å­˜å…¥å¿«å–
            setCachedUserData(userId, userData);
        } else {
            console.log("ä½¿ç”¨å¿«å–çš„ä½¿ç”¨è€…è³‡æ–™");
        }
        
        // å¦‚æœéœ€è¦è¼‰å…¥é¡å¤–çš„è©³ç´°è³‡æ–™
        if (options.includeDetails) {
            const detailsData = await ajaxPromise({
                url: `/api/users/${userId}/details`,
                method: 'GET',
                dataType: 'json'
            });
            
            userData.details = detailsData;
        }
        
        return userData;
        
    } catch (error) {
        console.error("è¼‰å…¥ä½¿ç”¨è€…è³‡æ–™å¤±æ•—ï¼š", error);
        throw error;
    }
}

// ä½¿ç”¨æ–¹å¼
const basicUserData = await smartUserDataLoader(123);
const detailedUserData = await smartUserDataLoader(123, { includeDetails: true });
const freshUserData = await smartUserDataLoader(123, { forceRefresh: true });
```

## é¿å…å¸¸è¦‹çš„é™·é˜±

è®“æˆ‘æé†’ä½ ä¸€äº›ä½¿ç”¨ async/await æ™‚å¸¸è¦‹çš„éŒ¯èª¤ï¼Œé€™æ¨£ä½ å°±èƒ½é¿å…å®ƒå€‘ï¼š

ç¬¬ä¸€å€‹å¸¸è¦‹éŒ¯èª¤æ˜¯å¿˜è¨˜åœ¨é ‚å±¤ä½¿ç”¨ awaitã€‚è¨˜ä½ï¼Œä½ ä¸èƒ½åœ¨é async å‡½å¼ä¸­ç›´æ¥ä½¿ç”¨ awaitï¼š

```javascript
// éŒ¯èª¤çš„å¯«æ³•
function normalFunction() {
    const result = await someAsyncOperation(); // é€™æœƒå°è‡´èªæ³•éŒ¯èª¤
}

// æ­£ç¢ºçš„å¯«æ³•
async function asyncFunction() {
    const result = await someAsyncOperation(); // é€™æ˜¯æ­£ç¢ºçš„
}

// æˆ–è€…åœ¨é ‚å±¤ç¨‹å¼ç¢¼ä¸­ï¼Œä½ éœ€è¦é€™æ¨£è™•ç†
someAsyncOperation().then(result => {
    console.log(result);
});
```

ç¬¬äºŒå€‹å¸¸è¦‹éŒ¯èª¤æ˜¯åœ¨è¿´åœˆä¸­éŒ¯èª¤ä½¿ç”¨ awaitï¼š

```javascript
// é€™æœƒä¾åºåŸ·è¡Œï¼Œå¯èƒ½æ¯”ä½ æƒ³çš„è¦æ…¢
async function slowWay(userIds) {
    const results = [];
    for (const userId of userIds) {
        const userData = await fetchUserData(userId); // æ¯æ¬¡éƒ½è¦ç­‰å¾…
        results.push(userData);
    }
    return results;
}

// é€™æœƒä¸¦è¡ŒåŸ·è¡Œï¼Œé€šå¸¸æ›´å¿«
async function fastWay(userIds) {
    const promises = userIds.map(userId => fetchUserData(userId));
    const results = await Promise.all(promises);
    return results;
}
```

## èˆ‡ä½ çš„é–‹ç™¼ç’°å¢ƒæ•´åˆ

åœ¨ä½ çš„ GTS ç³»çµ±ï¼ˆä½¿ç”¨è¼ƒèˆŠçš„ jQuery 1.10.2ï¼‰ä¸­ï¼Œä½ å¯èƒ½éœ€è¦è€ƒæ…®ç€è¦½å™¨ç›¸å®¹æ€§ã€‚async/await åœ¨è¼ƒèˆŠçš„ç€è¦½å™¨ä¸­å¯èƒ½ä¸è¢«æ”¯æ´ï¼Œä½†ä½ å¯ä»¥ä½¿ç”¨ Babel ç­‰å·¥å…·ä¾†è½‰æ›ç¨‹å¼ç¢¼ï¼Œæˆ–è€…åœ¨æ”¯æ´çš„ç’°å¢ƒä¸­é€æ­¥æ¡ç”¨ã€‚

ç¾åœ¨æˆ‘æƒ³å•ä½ ä¸€å€‹æ€è€ƒå•é¡Œï¼šåœ¨ä½ ç›®å‰çš„å°ˆæ¡ˆä¸­ï¼Œæœ‰æ²’æœ‰å“ªäº›åœ°æ–¹ä½¿ç”¨äº†å¾ˆå¤šå·¢ç‹€çš„å›èª¿å‡½å¼æˆ–è€…è¤‡é›œçš„ Promise éˆï¼Ÿé€™äº›åœ°æ–¹å¯èƒ½æ˜¯æ‡‰ç”¨ async/await çš„çµ•ä½³å€™é¸ã€‚

ä½ æ˜¯å¦æƒ³è¦å˜—è©¦å°‡æŸå€‹ç¾æœ‰çš„åŠŸèƒ½æ”¹å¯«ç‚ºä½¿ç”¨ async/awaitï¼Ÿæˆ–è€…ä½ å°æŸå€‹ç‰¹å®šçš„ä½¿ç”¨æƒ…å¢ƒæœ‰ç–‘å•ï¼Ÿæˆ‘å€‘å¯ä»¥ä¸€èµ·ä¾†æ¢è¨å…·é«”çš„å¯¦ä½œæ–¹å¼ã€‚