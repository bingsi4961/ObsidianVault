---
date : 2025-07-15 15:48
aliases:
  - åˆ¥åæ¸¬è©¦1
  - åˆ¥åæ¸¬è©¦2
tags:
  - æ¨™ç±¤æ¸¬è©¦1
  - æ¨™ç±¤æ¸¬è©¦2

---
# Metadata
Status :: ğŸŒ±
Note Type :: ğŸ“°
Source URL :: {æ–‡ç«  URL}
Author :: {ä½œè€…åç¨±}
Topics :: {ç­†è¨˜è·Ÿä»€éº¼ä¸»é¡Œæœ‰é—œï¼Œç”¨ `[Topic],[Topic]` æ ¼å¼}

---
# é€£çµç­†è¨˜
#### ğŸ“‘ [[]]
#### ğŸ“‘ [[]]

---

```CSharp
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.ViewFeatures;

public class HomeController : Controller
{
    // å‡è¨­é€™æ˜¯åŒäº‹å¯«å¥½çš„ functionB
    public IActionResult FunctionB()
    {
        // å»ºç«‹ Model
        var model = new PersonModel
        {
            Name = "å¼µä¸‰",
            Age = 30,
            Email = "zhang@example.com"
        };

        // è¨­å®š ViewBag
        ViewBag.Title = "å€‹äººè³‡æ–™";
        ViewBag.Message = "æ­¡è¿ä½¿ç”¨ç³»çµ±";
        ViewBag.CurrentTime = DateTime.Now;

        return View(model);
    }

    // æ‚¨çš„ MainFunctionï¼Œå¾ functionB å–å¾— Model å’Œ ViewBag
    public IActionResult MainFunction()
    {
        // æ–¹æ³• 1ï¼šç›´æ¥å‘¼å«ä¸¦è½‰æ›ç‚º ViewResult
        var viewResult = FunctionB() as ViewResult;
        
        if (viewResult != null)
        {
            // å–å¾— Model
            var model = viewResult.Model as PersonModel;
            
            // å–å¾— ViewBag
            var viewBag = viewResult.ViewData;
            
            // ç¾åœ¨æ‚¨å¯ä»¥ä½¿ç”¨ model å’Œ viewBag çš„å…§å®¹
            Console.WriteLine($"Name: {model?.Name}");
            Console.WriteLine($"Age: {model?.Age}");
            Console.WriteLine($"Title: {viewBag["Title"]}");
            Console.WriteLine($"Message: {viewBag["Message"]}");
            
            // æ‚¨å¯ä»¥ä¿®æ”¹æˆ–æ–°å¢ ViewBag å…§å®¹
            viewBag["AdditionalInfo"] = "é€™æ˜¯å¾ MainFunction æ–°å¢çš„è³‡è¨Š";
            
            // æ‚¨ä¹Ÿå¯ä»¥ä¿®æ”¹ Modelï¼ˆå¦‚æœéœ€è¦çš„è©±ï¼‰
            if (model != null)
            {
                model.Age = 31; // ä¿®æ”¹å¹´é½¡
            }
            
            // å›å‚³ä¿®æ”¹å¾Œçš„ ViewResultï¼Œæˆ–è€…å»ºç«‹æ–°çš„ View
            return View("MainView", model);
        }
        
        return View();
    }

    // æ–¹æ³• 2ï¼šæ›´å®‰å…¨çš„å–å¾—æ–¹å¼
    public IActionResult MainFunctionSafe()
    {
        var result = FunctionB();
        
        // æª¢æŸ¥æ˜¯å¦ç‚º ViewResult
        if (result is ViewResult viewResult)
        {
            // å®‰å…¨åœ°å–å¾— Model
            var model = viewResult.Model as PersonModel;
            
            // å–å¾— ViewBag (ViewData)
            var viewData = viewResult.ViewData;
            
            // å»ºç«‹æ–°çš„ ViewBag çµ¦ç›®å‰çš„ Action
            ViewBag.OriginalTitle = viewData["Title"];
            ViewBag.OriginalMessage = viewData["Message"];
            ViewBag.ProcessedBy = "MainFunction";
            
            // å¯ä»¥å°‡åŸå§‹ Model å‚³éçµ¦æ–°çš„ View
            return View("ProcessedView", model);
        }
        
        return View("Error");
    }

    // æ–¹æ³• 3ï¼šå–å¾—ç‰¹å®š ViewBag é …ç›®çš„æ³›å‹æ–¹æ³•
    public IActionResult MainFunctionGeneric()
    {
        var viewResult = FunctionB() as ViewResult;
        
        if (viewResult != null)
        {
            var model = viewResult.Model as PersonModel;
            var viewData = viewResult.ViewData;
            
            // ä½¿ç”¨æ³›å‹æ–¹æ³•å®‰å…¨åœ°å–å¾— ViewBag å€¼
            var title = GetViewBagValue<string>(viewData, "Title");
            var currentTime = GetViewBagValue<DateTime>(viewData, "CurrentTime");
            
            // è¨­å®šæ–°çš„ ViewBag
            ViewBag.ProcessedTitle = $"è™•ç†å¾Œçš„æ¨™é¡Œ: {title}";
            ViewBag.ProcessedTime = currentTime.ToString("yyyy-MM-dd HH:mm:ss");
            
            return View("FinalView", model);
        }
        
        return View();
    }

    // è¼”åŠ©æ–¹æ³•ï¼šå®‰å…¨åœ°å–å¾— ViewBag å€¼
    private T GetViewBagValue<T>(ViewDataDictionary viewData, string key)
    {
        if (viewData.ContainsKey(key) && viewData[key] is T value)
        {
            return value;
        }
        return default(T);
    }

    // æ–¹æ³• 4ï¼šå¦‚æœæ‚¨éœ€è¦å–å¾— ViewResult çš„å…¶ä»–å±¬æ€§
    public IActionResult MainFunctionAdvanced()
    {
        var viewResult = FunctionB() as ViewResult;
        
        if (viewResult != null)
        {
            // å–å¾— Model
            var model = viewResult.Model;
            
            // å–å¾— ViewData (åŒ…å« ViewBag)
            var viewData = viewResult.ViewData;
            
            // å–å¾— View åç¨±
            var viewName = viewResult.ViewName;
            
            // å–å¾— TempData
            var tempData = viewResult.TempData;
            
            // å–å¾— ContentType
            var contentType = viewResult.ContentType;
            
            // å–å¾— StatusCode
            var statusCode = viewResult.StatusCode;
            
            Console.WriteLine($"View Name: {viewName}");
            Console.WriteLine($"Status Code: {statusCode}");
            Console.WriteLine($"Content Type: {contentType}");
            
            // è¤‡è£½æ‰€æœ‰ ViewData åˆ°ç•¶å‰çš„ ViewData
            foreach (var item in viewData)
            {
                ViewData[item.Key] = item.Value;
            }
            
            // æ–°å¢é¡å¤–çš„ ViewBag è³‡è¨Š
            ViewBag.ProcessedByAdvanced = true;
            ViewBag.ProcessingTime = DateTime.Now;
            
            return View("AdvancedView", model);
        }
        
        return View();
    }
}

// ç¯„ä¾‹ Model é¡åˆ¥
public class PersonModel
{
    public string Name { get; set; }
    public int Age { get; set; }
    public string Email { get; set; }
}
```